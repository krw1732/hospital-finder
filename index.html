<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“ NFC ë³‘ì› ì°¾ê¸°</title>
  <style>
    body {
      font-family: 'ë§‘ì€ ê³ ë”•', sans-serif;
      text-align: center;
      padding: 0;
      margin: 0;
      background-color: #f9f9f9;
    }
    h2 {
      margin-top: 40px;
      color: #333;
    }
    button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 16px;
      background-color: #4285F4;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #message {
      margin-top: 20px;
      font-weight: bold;
      color: red;
    }
    #map {
      width: 100%;
      height: 75vh;
      margin-top: 20px;
      display: none;
    }
  </style>
</head>
<body>

<h2>ğŸ“² NFC íƒœê·¸ë¥¼ ì¸ì‹í•˜ë©´ ì£¼ë³€ ë³‘ì›ì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤</h2>
<button id="scanBtn">NFC íƒœê·¸ ìŠ¤ìº” ì‹œì‘</button>
<div id="message"></div>
<div id="map"></div>

<script>
  let map;
  const scanBtn = document.getElementById("scanBtn");
  const messageEl = document.getElementById("message");
  const mapEl = document.getElementById("map");

  function showMessage(msg, color = 'red') {
    messageEl.textContent = msg;
    messageEl.style.color = color;
  }

  async function startNFCScan() {
    if (!('NDEFReader' in window)) {
      showMessage("âš ï¸ Web NFCëŠ” Android Chromeì—ì„œë§Œ ì‘ë™í•©ë‹ˆë‹¤.", 'red');
      return;
    }

    const reader = new NDEFReader();
    try {
      await reader.scan();
      showMessage("ğŸ“¶ í•¸ë“œí° ë’·ë©´ì— NFC íƒœê·¸ë¥¼ ëŒ€ì£¼ì„¸ìš”...", 'green');

      reader.onreading = (event) => {
        showMessage("âœ… íƒœê·¸ ì¸ì‹ ì™„ë£Œ! ë³‘ì› ìœ„ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...", 'green');
        reader.onreading = null; // ì¤‘ë³µ ë°©ì§€
        showNearbyHospitals();
      };

    } catch (err) {
      showMessage("âŒ NFC ìŠ¤ìº” ì˜¤ë¥˜: " + err.message);
    }
  }

  function showNearbyHospitals() {
    if (!navigator.geolocation) {
      showMessage("âŒ ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
      return;
    }

    mapEl.style.display = "block";

    navigator.geolocation.getCurrentPosition(
      (position) => {
        const location = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };

        map = new google.maps.Map(mapEl, {
          center: location,
          zoom: 15
        });

        new google.maps.Marker({
          map,
          position: location,
          title: "ë‚´ ìœ„ì¹˜",
          icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
        });

        const service = new google.maps.places.PlacesService(map);
        service.nearbySearch({
          location,
          radius: 2000,
          type: ['hospital']
        }, (results, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
            results.forEach(place => {
              new google.maps.Marker({
                map,
                position: place.geometry.location,
                title: place.name
              });
            });
          } else {
            showMessage("ğŸ“ ê·¼ì²˜ ë³‘ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'orange');
          }
        });
      },
      (error) => {
        showMessage("â— ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ìœ„ì¹˜ í—ˆìš©ì„ í•´ì£¼ì„¸ìš”.");
      }
    );
  }

  scanBtn.addEventListener("click", startNFCScan);
</script>

<!-- ğŸ”‘ Google Maps API (YOUR_API_KEY ë¶€ë¶„ì„ ë³¸ì¸ì˜ í‚¤ë¡œ êµì²´í•˜ì„¸ìš”) -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>

</body>
</html>
