<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>내 주변 병원 찾기</title>
    <style>
      body {
        margin: 0;
        font-family: '맑은 고딕', sans-serif;
      }
      #map {
        height: 90vh;
        width: 100%;
      }
      #message {
        text-align: center;
        padding: 10px;
        color: red;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h2 style="text-align:center;">🏥 내 주변 병원 찾기</h2>
    <div id="message"></div>
    <div id="map"></div>

    <script>
      let map;

      function showMessage(text) {
        document.getElementById("message").textContent = text;
      }

      function initMap() {
        if (location.protocol !== "https:" && location.hostname !== "localhost") {
          showMessage("⚠️ 위치 정보를 위해 HTTPS 접속이 필요합니다.");
          return;
        }

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            position => {
              const userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };

              map = new google.maps.Map(document.getElementById("map"), {
                center: userLocation,
                zoom: 15
              });

              new google.maps.Marker({
                position: userLocation,
                map: map,
                title: "현재 위치",
                icon: {
                  url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                }
              });

              const request = {
                location: userLocation,
                radius: '2000',
                type: ['hospital']
              };

              const service = new google.maps.places.PlacesService(map);
              service.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
                  results.forEach(place => {
                    new google.maps.Marker({
                      map,
                      position: place.geometry.location,
                      title: place.name
                    });
                  });
                } else {
                  showMessage("📍 근처 병원을 찾을 수 없습니다.");
                }
              });
            },
            error => {
              showMessage("📍 위치 권한이 필요합니다. 브라우저 설정을 확인해주세요.");
            }
          );
        } else {
          showMessage("이 브라우저는 위치 정보 기능을 지원하지 않습니다.");
        }
      }
    </script>

    <!-- Google Maps API (YOUR_API_KEY 부분 교체 필수) -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places&callback=initMap" async defer></script>
  </body>
</html>

